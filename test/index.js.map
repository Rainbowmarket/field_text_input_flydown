{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@rainbowmarket/field-text-input-flydown/webpack/universalModuleDefinition","webpack://@rainbowmarket/field-text-input-flydown/external umd {\"root\":\"Blockly\",\"commonjs\":\"blockly/core\",\"commonjs2\":\"blockly/core\",\"amd\":\"blockly/core\"}","webpack://@rainbowmarket/field-text-input-flydown/webpack/bootstrap","webpack://@rainbowmarket/field-text-input-flydown/webpack/runtime/define property getters","webpack://@rainbowmarket/field-text-input-flydown/webpack/runtime/hasOwnProperty shorthand","webpack://@rainbowmarket/field-text-input-flydown/webpack/runtime/make namespace object","webpack://@rainbowmarket/field-text-input-flydown/./src/field/field_input_flydown_block.js","webpack://@rainbowmarket/field-text-input-flydown/./src/style/css.js","webpack://@rainbowmarket/field-text-input-flydown/./src/field/flydown.js","webpack://@rainbowmarket/field-text-input-flydown/./src/field/feald_flydown_init.js","webpack://@rainbowmarket/field-text-input-flydown/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"blockly/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"blockly/core\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"blockly/core\")) : factory(root[\"Blockly\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, (__WEBPACK_EXTERNAL_MODULE__370__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__370__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\n\nimport * as Blockly from 'blockly/core';\n\nexport class FieldTextInputWithFlydown extends Blockly.FieldTextInput {\n    static timeout = 500;\n    static showPid_ = 0;\n    static openFieldFlydown_ = null;\n    static DISPLAY_BELOW = 'BELOW';\n    static DISPLAY_RIGHT = 'RIGHT';\n    static DISPLAY_LOCATION = FieldTextInputWithFlydown.DISPLAY_BELOW;\n\n    constructor(name, xmlData, opt_displayLocation) {\n        super(name);\n        this.EDITABLE = true;\n        this.displayLocation = opt_displayLocation || FieldTextInputWithFlydown.DISPLAY_RIGHT;\n        this.xmlData = xmlData || '';\n    }\n\n    init(block) {\n        super.init(block);\n        Blockly.utils.dom.addClass(this.fieldGroup_, this.fieldCSSClassName);\n\n        this.mouseOverWrapper_ = Blockly.browserEvents.bind(\n            this.fieldGroup_, 'mouseover', this, this.onMouseOver_\n        );\n        this.mouseOutWrapper_ = Blockly.browserEvents.bind(\n            this.fieldGroup_, 'mouseout', this, this.onMouseOut_\n        );\n    }\n\n    onMouseOver_(e) {\n        if (!this.sourceBlock_.isInFlyout && FieldTextInputWithFlydown.showPid_ == 0) {\n            FieldTextInputWithFlydown.showPid_ = window.setTimeout(\n                this.showFlydownMaker_(),\n                FieldTextInputWithFlydown.timeout\n            );\n        }\n        e.stopPropagation();\n    }\n\n    onMouseOut_(e) {\n        window.clearTimeout(FieldTextInputWithFlydown.showPid_);\n        FieldTextInputWithFlydown.showPid_ = 0;\n        e.stopPropagation();\n    }\n\n    showFlydownMaker_() {\n        const field = this;\n        return function () {\n            if (FieldTextInputWithFlydown.showPid_ !== 0 &&\n                !field.getSourceBlock().workspace.isDragging() &&\n                !field.htmlInput_) {\n                try {\n                    field.showFlydown_();\n                } catch (e) {\n                    console.error('Failed to show flydown', e);\n                }\n            }\n            FieldTextInputWithFlydown.showPid_ = 0;\n        };\n    }\n\n    showFlydown_() {\n        const workspace = Blockly.common.getMainWorkspace();\n        if (!workspace) {\n            console.error(\"Main workspace is not available!\");\n            return;\n        }\n\n        workspace.hideChaff();\n        \n        const flydown = workspace.getFlydown();\n        if (!flydown || !flydown.svgGroup_) {\n            console.error(\"Flydown or its SVG group is not properly initialized!\");\n            return;\n        }\n    \n        Blockly.common.getMainWorkspace().getParentSvg().appendChild(flydown.svgGroup_);\n    \n        const scale = flydown.targetWorkspace.scale;\n        flydown.workspace_.setScale(scale);\n    \n        flydown.setCSSClass(this.flyoutCSSClassName);\n\n        const parentBlock = this.getSourceBlock().getParent();\n        const blockColor = parentBlock ? parentBlock.getColour() : this.getSourceBlock().getColour();\n        document.documentElement.style.setProperty('--flydown-bg-color', blockColor);\n            \n        const blocksXMLText = this.flydownBlocksXML_();\n        const blocksDom = Blockly.utils.xml.textToDom(blocksXMLText);\n        const blocksXMLList = blocksDom.children;\n    \n        const xy = Blockly.common.getMainWorkspace().getSvgXY(this.borderRect_);\n        const borderBBox = this.borderRect_.getBBox();\n    \n        xy.y += borderBBox.height * scale + 5;\n    \n        flydown.field_ = this;\n        flydown.showAt(blocksXMLList, xy.x, xy.y);\n        FieldTextInputWithFlydown.openFieldFlydown_ = this;\n    }\n    \n    flydownBlocksXML_() {\n        const name = this.getText() || 'default';\n        \n        if (this.xmlData) {\n            try {\n                return this.xmlData.replace(/{{text}}/g, name);\n            } catch (e) {\n                console.error('Error processing XML template:', e);\n                return this.getDefaultXML_(name);\n            }\n        }\n        \n        return this.getDefaultXML_(name);\n    }\n    \n    getDefaultXML_(name) {\n        return `\n            <xml>\n                <block type=\"variables_get\">\n                    <field name=\"VAR\">${name}</field>\n                </block>\n                <block type=\"variables_set\">\n                    <field name=\"VAR\">${name}</field>\n                </block>\n            </xml>\n        `;\n    }\n\n    static hide() {\n        window.clearTimeout(FieldTextInputWithFlydown.showPid_);\n        const flydown = Blockly.common.getMainWorkspace().getFlydown();\n        if (flydown) {\n            flydown.hide();\n        }\n    }\n\n    dispose() {\n        // Current implementation\n        if (FieldTextInputWithFlydown.openFieldFlydown_ == this) {\n            FieldTextInputWithFlydown.hide();\n        }\n        super.dispose();\n        \n        // Should also clean up event listeners:\n        if (this.mouseOverWrapper_) {\n            Blockly.browserEvents.unbind(this.mouseOverWrapper_);\n            this.mouseOverWrapper_ = null;\n        }\n        if (this.mouseOutWrapper_) {\n            Blockly.browserEvents.unbind(this.mouseOutWrapper_);\n            this.mouseOutWrapper_ = null;\n        }\n    }\n}\n","'use strict';\n\nconst cssNode = document.createElement('style');\ndocument.head.appendChild(cssNode);\n\nexport function registerCss(selector) {\n  cssNode.textContent = `\n  ${selector}  .blocklyFieldFlydownFlydown > path {\n    fill: var(--flydown-bg-color) !important;\n    fill-opacity: 0.5;\n    stroke: var(--flydown-bg-color) !important;\n    stroke-width: 4;\n  }\n  .blocklyFieldFlydownFlydown > path {\n    fill: var(--flydown-bg-color) !important;\n    fill-opacity: 0.5;\n    stroke: var(--flydown-bg-color) !important;\n    stroke-width: 4;\n  }\n  `;\n}","'use strict';\n\nimport * as Blockly from 'blockly/core';\nimport {FieldTextInputWithFlydown} from './field_input_flydown_block.js';\n\nexport class Flydown extends Blockly.VerticalFlyout {\n  constructor(workspaceOptions) {\n    super(workspaceOptions);\n    this.dragAngleRange_ = 360;\n  }\n};\n\nFlydown.prototype.previousCSSClassName_ = '';\n\nFlydown.prototype.VERTICAL_SEPARATION_FACTOR = 1;\n\nFlydown.prototype.createDom = function(cssClassName) {\n\n  this.previousCSSClassName_ = cssClassName; \n  this.svgGroup_ =\n      Blockly.utils.dom.createSvgElement('g', {'class': cssClassName}, null);\n  this.svgBackground_ =\n      Blockly.utils.dom.createSvgElement('path', {}, this.svgGroup_);\n  this.svgGroup_.appendChild(this.workspace_.createDom());\n  return this.svgGroup_;\n};\n\nFlydown.prototype.setCSSClass = function(newCSSClassName) {\n  if (newCSSClassName !== this.previousCSSClassName_) {\n    Blockly.utils.dom.removeClass(this.svgGroup_, this.previousCSSClassName_);\n    Blockly.utils.dom.addClass(this.svgGroup_, newCSSClassName);\n    this.previousCSSClassName_ = newCSSClassName;\n  }\n};\n\nFlydown.prototype.init = function(workspace) {\n  Blockly.Flyout.prototype.init.call(this, workspace, false);\n  this.workspace_.setTheme(workspace.getTheme());\n\n  const componentManager = workspace.getComponentManager();\n  if (!componentManager.hasCapability(this.id, Blockly.ComponentManager.Capability.AUTOHIDEABLE)) {\n      componentManager.addCapability(this.id, Blockly.ComponentManager.Capability.AUTOHIDEABLE);\n  }\n};\n\n\nFlydown.prototype.position = function() {\n  return;\n};\n\nFlydown.prototype.showAt = function(xmlList, x, y) {\n  Blockly.Events.disable();\n  try {\n\n    this.show(xmlList);\n  } finally {\n    Blockly.Events.enable();\n  }\n\n  const margin = this.CORNER_RADIUS * this.workspace_.scale;\n  const edgeWidth = this.width_ - 2 * margin;\n  const edgeHeight = this.height_ - 2 * margin;\n  const path = ['M 0,' + margin];\n  path.push('a', margin, margin, 0, 0, 1, margin, -margin); \n  path.push('h', edgeWidth); \n  path.push('a', margin, margin, 0, 0, 1, margin, margin); \n  path.push('v', edgeHeight); \n  path.push('a', margin, margin, 0, 0, 1, -margin, margin); \n  path.push('h', -edgeWidth); \n  path.push('a', margin, margin, 0, 0, 1, -margin, -margin); \n  path.push('z'); \n  this.svgBackground_.setAttribute('d', path.join(' '));\n  this.svgGroup_.setAttribute('transform', 'translate(' + x + ', ' + y + ')');\n};\n\nFlydown.prototype.reflow = function() {\n  this.workspace_.scale = this.targetWorkspace.scale;\n  const scale = this.workspace_.scale;\n  let flydownWidth = 0;\n  let flydownHeight = 0;\n  const margin = this.CORNER_RADIUS * scale;\n  const blocks = this.workspace_.getTopBlocks(false);\n  for (let i = 0, block; block = blocks[i]; i++) {\n    const blockHW = block.getHeightWidth();\n    flydownWidth = Math.max(flydownWidth, blockHW.width * scale);\n    flydownHeight += blockHW.height * scale;\n  }\n  flydownWidth += 2 * margin + this.tabWidth_ * scale; \n\n  const rendererConstants = this.workspace_.getRenderer().getConstants();\n  const startHatHeight = rendererConstants.ADD_START_HATS ?\n      rendererConstants.START_HAT_HEIGHT : 0;\n  flydownHeight += 3 * margin +\n      margin * this.VERTICAL_SEPARATION_FACTOR * (blocks.length) +\n      startHatHeight * scale / 2.0;\n  if (this.width_ != flydownWidth) {\n    for (let j = 0, block; block = blocks[j]; j++) {\n      const blockHW = block.getHeightWidth();\n      const blockXY = block.getRelativeToSurfaceXY();\n      if (this.RTL) {\n\n        const dx = flydownWidth - margin - scale * (this.tabWidth_ - blockXY.x);\n        block.moveBy(dx, 0);\n        blockXY.x += dx;\n      }\n      if (block.flyoutRect_) {\n        block.flyoutRect_.setAttribute('width', blockHW.width);\n        block.flyoutRect_.setAttribute('height', blockHW.height);\n        block.flyoutRect_.setAttribute('x',\n            this.RTL ? blockXY.x - blockHW.width : blockXY.x);\n        block.flyoutRect_.setAttribute('y', blockXY.y);\n      }\n    }\n\n    this.width_ = flydownWidth;\n    this.height_ = flydownHeight;\n  }\n};\n\nFlydown.prototype.onMouseMove_ = function(e) {\n\n  return;\n};\n\nFlydown.prototype.placeNewBlock_ = function(originBlock) {\n  const targetWorkspace = this.targetWorkspace;\n  const svgRootOld = originBlock.getSvgRoot();\n  if (!svgRootOld) {\n    throw Error('originBlock is not rendered.');\n  }\n\n  let scale = this.workspace_.scale;\n\n  const xyOld = this.workspace_.getSvgXY(svgRootOld);\n\n  const scrollX = xyOld.x;\n  xyOld.x += scrollX / targetWorkspace.scale - scrollX;\n\n  const scrollY = xyOld.y;\n  scale = targetWorkspace.scale;\n  xyOld.y += scrollY / scale - scrollY;\n\n  const xml = Blockly.Xml.blockToDom(originBlock);\n  const block = Blockly.Xml.domToBlock(xml, targetWorkspace);\n  const svgRootNew = block.getSvgRoot();\n  if (!svgRootNew) {\n    throw Error('block is not rendered.');\n  }\n\n  const xyNew = targetWorkspace.getSvgXY(svgRootNew);\n\n  xyNew.x +=\n      targetWorkspace.scrollX / targetWorkspace.scale - targetWorkspace.scrollX;\n  xyNew.y +=\n      targetWorkspace.scrollY / targetWorkspace.scale - targetWorkspace.scrollY;\n\n  if (targetWorkspace.toolbox_ && !targetWorkspace.scrollbar) {\n    xyNew.x += targetWorkspace.toolbox_.getWidth() / targetWorkspace.scale;\n    xyNew.y += targetWorkspace.toolbox_.getHeight() / targetWorkspace.scale;\n  }\n\n  block.moveBy(xyOld.x - xyNew.x, xyOld.y - xyNew.y);\n  return block;\n};\n\nFlydown.prototype.shouldHide = true;\n\nFlydown.prototype.hide = function() {\n  if (this.shouldHide) {\n    Blockly.Flyout.prototype.hide.call(this);\n    FieldTextInputWithFlydown.openFieldFlydown_ = null;\n  }\n  this.shouldHide = true;\n};\n\nFlydown.prototype.autoHide = function() {\n  this.hide();\n};\n\n","'use strict';\n\n\nimport * as Blockly from 'blockly/core';\nimport { registerCss } from '../style/css.js';\nimport { Flydown } from '../field/flydown.js';\n\nexport class FieldFlydown {\n\n    static init(workspace) {\n        if (workspace.flydown_) {\n            return; // Prevent duplicate initialization\n        }\n\n        const rendererName = workspace.getRenderer().getClassName();\n        const themeName = workspace.getTheme().getClassName();\n        const selector = `.${rendererName}.${themeName}`;\n        registerCss(selector);\n\n        const flydown = new Flydown(\n            new Blockly.Options({\n                scrollbars: false,\n                rtl: workspace.RTL,\n                renderer: workspace.options.renderer,\n                rendererOverrides: workspace.options.rendererOverrides,\n                parentWorkspace: workspace,\n            })\n        );\n\n        workspace.getFlydown = function () {\n            return this.flydown_;\n        };\n        \n        workspace.flydown_ = flydown;\n        Blockly.utils.dom.insertAfter(flydown.createDom('g'), workspace.svgBubbleCanvas_);\n        flydown.init(workspace);\n        flydown.autoClose = true;\n    }\n\n    static Flydown = Flydown;\n}\n","import { FieldTextInputWithFlydown } from './field/field_input_flydown_block.js';\nimport { FieldFlydown } from './field/feald_flydown_init.js';\n\nFieldTextInputWithFlydown.prototype.fieldCSSClassName = 'blocklyFieldFlydownField';\nFieldTextInputWithFlydown.prototype.flyoutCSSClassName = 'blocklyFieldFlydownFlydown';\n\nif (!Blockly.registry.hasItem(Blockly.registry.Type.FIELD, 'field_text_input_with_flydown')) {\n  Blockly.registry.register(\n    Blockly.registry.Type.FIELD,\n    'field_text_input_with_flydown',\n    FieldTextInputWithFlydown\n  );\n} else {\n  console.warn('Field \"field_text_input_with_flydown\" is already registered.');\n}\n\nexport { FieldTextInputWithFlydown, FieldFlydown };"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE__370__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","FieldTextInputWithFlydown","static","DISPLAY_BELOW","constructor","name","xmlData","opt_displayLocation","super","EDITABLE","displayLocation","DISPLAY_RIGHT","init","block","dom","addClass","fieldGroup_","fieldCSSClassName","mouseOverWrapper_","bind","onMouseOver_","mouseOutWrapper_","onMouseOut_","e","sourceBlock_","isInFlyout","showPid_","window","setTimeout","showFlydownMaker_","timeout","stopPropagation","clearTimeout","field","getSourceBlock","workspace","isDragging","htmlInput_","showFlydown_","console","error","getMainWorkspace","hideChaff","flydown","getFlydown","svgGroup_","getParentSvg","appendChild","scale","targetWorkspace","workspace_","setScale","setCSSClass","flyoutCSSClassName","parentBlock","getParent","blockColor","getColour","document","documentElement","style","setProperty","blocksXMLText","flydownBlocksXML_","blocksXMLList","xml","textToDom","children","xy","getSvgXY","borderRect_","borderBBox","getBBox","y","height","field_","showAt","x","openFieldFlydown_","getText","replace","getDefaultXML_","hide","dispose","unbind","cssNode","createElement","head","Flydown","workspaceOptions","dragAngleRange_","previousCSSClassName_","VERTICAL_SEPARATION_FACTOR","createDom","cssClassName","createSvgElement","svgBackground_","newCSSClassName","removeClass","setTheme","getTheme","componentManager","getComponentManager","hasCapability","id","Capability","AUTOHIDEABLE","addCapability","position","xmlList","disable","show","enable","margin","CORNER_RADIUS","edgeWidth","width_","edgeHeight","height_","path","push","setAttribute","join","reflow","flydownWidth","flydownHeight","blocks","getTopBlocks","blockHW","getHeightWidth","Math","max","width","tabWidth_","rendererConstants","getRenderer","getConstants","startHatHeight","ADD_START_HATS","START_HAT_HEIGHT","j","blockXY","getRelativeToSurfaceXY","RTL","dx","moveBy","flyoutRect_","onMouseMove_","placeNewBlock_","originBlock","svgRootOld","getSvgRoot","Error","xyOld","scrollX","scrollY","blockToDom","domToBlock","svgRootNew","xyNew","toolbox_","scrollbar","getWidth","getHeight","shouldHide","autoHide","FieldFlydown","flydown_","selector","getClassName","textContent","scrollbars","rtl","renderer","options","rendererOverrides","parentWorkspace","insertAfter","svgBubbleCanvas_","autoClose","Blockly","registry","hasItem","Type","FIELD","warn","register"],"sourceRoot":""}