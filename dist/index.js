!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var o="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var s in o)("object"==typeof exports?exports:t)[s]=o[s]}}(this,(t=>(()=>{"use strict";var e={370:e=>{e.exports=t}},o={};function s(t){var i=o[t];if(void 0!==i)return i.exports;var r=o[t]={exports:{}};return e[t](r,r.exports,s),r.exports}s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};s.r(i),s.d(i,{FieldFlydown:()=>c,FieldTextInputWithFlydown:()=>l});var r=s(370);class l extends r.FieldTextInput{static timeout=500;static showPid_=0;static openFieldFlydown_=null;static DISPLAY_BELOW="BELOW";static DISPLAY_RIGHT="RIGHT";static DISPLAY_LOCATION=l.DISPLAY_BELOW;constructor(t,e,o){super(t),this.EDITABLE=!0,this.displayLocation=o||l.DISPLAY_RIGHT,this.xmlData=e||""}init(t){super.init(t),r.utils.dom.addClass(this.fieldGroup_,this.fieldCSSClassName),this.mouseOverWrapper_=r.browserEvents.bind(this.fieldGroup_,"mouseover",this,this.onMouseOver_),this.mouseOutWrapper_=r.browserEvents.bind(this.fieldGroup_,"mouseout",this,this.onMouseOut_)}onMouseOver_(t){this.sourceBlock_.isInFlyout||0!=l.showPid_||(l.showPid_=window.setTimeout(this.showFlydownMaker_(),l.timeout)),t.stopPropagation()}onMouseOut_(t){window.clearTimeout(l.showPid_),l.showPid_=0,t.stopPropagation()}showFlydownMaker_(){const t=this;return function(){if(0!==l.showPid_&&!t.getSourceBlock().workspace.isDragging()&&!t.htmlInput_)try{t.showFlydown_()}catch(t){console.error("Failed to show flydown",t)}l.showPid_=0}}showFlydown_(){if(r.common.getMainWorkspace().hideChaff(),"function"!=typeof r.common.getMainWorkspace().getFlydown)return void console.error("Flydown workspace is not properly initialized!");const t=r.common.getMainWorkspace().getFlydown();if(!t)return void console.error("Flydown is not available!");r.common.getMainWorkspace().getParentSvg().appendChild(t.svgGroup_);const e=t.targetWorkspace.scale;t.workspace_.setScale(e),t.setCSSClass(this.flyoutCSSClassName);const o=this.getSourceBlock().getParent(),s=o?o.getColour():this.getSourceBlock().getColour();document.documentElement.style.setProperty("--flydown-bg-color",s);const i=this.flydownBlocksXML_(),n=r.utils.xml.textToDom(i).children,a=r.common.getMainWorkspace().getSvgXY(this.borderRect_),c=this.borderRect_.getBBox();a.y+=c.height*e+5,t.field_=this,t.showAt(n,a.x,a.y),l.openFieldFlydown_=this}flydownBlocksXML_(){const t=this.getText()||"default";return(this.xmlData?this.xmlData.replace(/{{text}}/g,t):null)||`\n            <xml>\n                <block type="variables_get">\n                    <field name="VAR">${t}</field>\n                </block>\n                <block type="variables_set">\n                    <field name="VAR">${t}</field>\n                </block>\n            </xml>\n        `}static hide(){window.clearTimeout(l.showPid_);const t=r.common.getMainWorkspace().getFlydown();t&&t.hide()}dispose(){l.openFieldFlydown_==this&&l.hide(),super.dispose()}}const n=document.createElement("style");document.head.appendChild(n);class a extends r.VerticalFlyout{constructor(t){super(t),this.dragAngleRange_=360}}a.prototype.previousCSSClassName_="",a.prototype.VERTICAL_SEPARATION_FACTOR=1,a.prototype.createDom=function(t){return this.previousCSSClassName_=t,this.svgGroup_=r.utils.dom.createSvgElement("g",{class:t},null),this.svgBackground_=r.utils.dom.createSvgElement("path",{},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.svgGroup_},a.prototype.setCSSClass=function(t){t!==this.previousCSSClassName_&&(r.utils.dom.removeClass(this.svgGroup_,this.previousCSSClassName_),r.utils.dom.addClass(this.svgGroup_,t),this.previousCSSClassName_=t)},a.prototype.init=function(t){r.Flyout.prototype.init.call(this,t,!1),this.workspace_.setTheme(t.getTheme());const e=t.getComponentManager();e.hasCapability(this.id,r.ComponentManager.Capability.AUTOHIDEABLE)||e.addCapability(this.id,r.ComponentManager.Capability.AUTOHIDEABLE)},a.prototype.position=function(){},a.prototype.showAt=function(t,e,o){r.Events.disable();try{this.show(t)}finally{r.Events.enable()}const s=this.CORNER_RADIUS*this.workspace_.scale,i=this.width_-2*s,l=this.height_-2*s,n=["M 0,"+s];n.push("a",s,s,0,0,1,s,-s),n.push("h",i),n.push("a",s,s,0,0,1,s,s),n.push("v",l),n.push("a",s,s,0,0,1,-s,s),n.push("h",-i),n.push("a",s,s,0,0,1,-s,-s),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" ")),this.svgGroup_.setAttribute("transform","translate("+e+", "+o+")")},a.prototype.reflow=function(){this.workspace_.scale=this.targetWorkspace.scale;const t=this.workspace_.scale;let e=0,o=0;const s=this.CORNER_RADIUS*t,i=this.workspace_.getTopBlocks(!1);for(let s,r=0;s=i[r];r++){const i=s.getHeightWidth();e=Math.max(e,i.width*t),o+=i.height*t}e+=2*s+this.tabWidth_*t;const r=this.workspace_.getRenderer().getConstants(),l=r.ADD_START_HATS?r.START_HAT_HEIGHT:0;if(o+=3*s+s*this.VERTICAL_SEPARATION_FACTOR*i.length+l*t/2,this.width_!=e){for(let o,r=0;o=i[r];r++){const i=o.getHeightWidth(),r=o.getRelativeToSurfaceXY();if(this.RTL){const i=e-s-t*(this.tabWidth_-r.x);o.moveBy(i,0),r.x+=i}o.flyoutRect_&&(o.flyoutRect_.setAttribute("width",i.width),o.flyoutRect_.setAttribute("height",i.height),o.flyoutRect_.setAttribute("x",this.RTL?r.x-i.width:r.x),o.flyoutRect_.setAttribute("y",r.y))}this.width_=e,this.height_=o}},a.prototype.onMouseMove_=function(t){},a.prototype.placeNewBlock_=function(t){const e=this.targetWorkspace,o=t.getSvgRoot();if(!o)throw Error("originBlock is not rendered.");let s=this.workspace_.scale;const i=this.workspace_.getSvgXY(o),l=i.x;i.x+=l/e.scale-l;const n=i.y;s=e.scale,i.y+=n/s-n;const a=r.Xml.blockToDom(t),c=r.Xml.domToBlock(a,e),d=c.getSvgRoot();if(!d)throw Error("block is not rendered.");const h=e.getSvgXY(d);return h.x+=e.scrollX/e.scale-e.scrollX,h.y+=e.scrollY/e.scale-e.scrollY,e.toolbox_&&!e.scrollbar&&(h.x+=e.toolbox_.getWidth()/e.scale,h.y+=e.toolbox_.getHeight()/e.scale),c.moveBy(i.x-h.x,i.y-h.y),c},a.prototype.shouldHide=!0,a.prototype.hide=function(){this.shouldHide&&(r.Flyout.prototype.hide.call(this),l.openFieldFlydown_=null),this.shouldHide=!0},a.prototype.autoHide=function(){this.hide()};class c{static init(t){if(t.flydown_)return;var e;e=`.${t.getRenderer().getClassName()}.${t.getTheme().getClassName()}`,n.textContent=`\n  ${e}  .blocklyFieldFlydownFlydown > path {\n    fill: var(--flydown-bg-color) !important;\n    fill-opacity: 0.5;\n    stroke: var(--flydown-bg-color) !important;\n    stroke-width: 4;\n  }\n  .blocklyFieldFlydownFlydown > path {\n    fill: var(--flydown-bg-color) !important;\n    fill-opacity: 0.5;\n    stroke: var(--flydown-bg-color) !important;\n    stroke-width: 4;\n  }\n  `;const o=new a(new r.Options({scrollbars:!1,rtl:t.RTL,renderer:t.options.renderer,rendererOverrides:t.options.rendererOverrides,parentWorkspace:t}));t.getFlydown=function(){return this.flydown_},t.flydown_=o,r.utils.dom.insertAfter(o.createDom("g"),t.svgBubbleCanvas_),o.init(t),o.autoClose=!0}static Flydown=a}return l.prototype.fieldCSSClassName="blocklyFieldFlydownField",l.prototype.flyoutCSSClassName="blocklyFieldFlydownFlydown",Blockly.registry.hasItem(Blockly.registry.Type.FIELD,"field_text_input_with_flydown")?console.warn('Field "field_text_input_with_flydown" is already registered.'):Blockly.registry.register(Blockly.registry.Type.FIELD,"field_text_input_with_flydown",l),i})()));
//# sourceMappingURL=index.js.map