{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@Rainbowmarket/field-text-input-flydown/webpack/universalModuleDefinition","webpack://@Rainbowmarket/field-text-input-flydown/external umd {\"root\":\"Blockly\",\"commonjs\":\"blockly/core\",\"commonjs2\":\"blockly/core\",\"amd\":\"blockly/core\"}","webpack://@Rainbowmarket/field-text-input-flydown/webpack/bootstrap","webpack://@Rainbowmarket/field-text-input-flydown/webpack/runtime/define property getters","webpack://@Rainbowmarket/field-text-input-flydown/webpack/runtime/hasOwnProperty shorthand","webpack://@Rainbowmarket/field-text-input-flydown/webpack/runtime/make namespace object","webpack://@Rainbowmarket/field-text-input-flydown/./src/field/field_input_flydown_block.js","webpack://@Rainbowmarket/field-text-input-flydown/./src/style/css.js","webpack://@Rainbowmarket/field-text-input-flydown/./src/field/flydown.js","webpack://@Rainbowmarket/field-text-input-flydown/./src/field/feald_flydown_init.js","webpack://@Rainbowmarket/field-text-input-flydown/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"blockly/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"blockly/core\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"blockly/core\")) : factory(root[\"Blockly\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, (__WEBPACK_EXTERNAL_MODULE__370__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__370__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\n\nimport * as Blockly from 'blockly/core';\n\nexport class FieldTextInputWithFlydown extends Blockly.FieldTextInput {\n    static timeout = 500;\n    static showPid_ = 0;\n    static openFieldFlydown_ = null;\n    static DISPLAY_BELOW = 'BELOW';\n    static DISPLAY_RIGHT = 'RIGHT';\n    static DISPLAY_LOCATION = FieldTextInputWithFlydown.DISPLAY_BELOW;\n\n    constructor(name, isEditable, opt_displayLocation) {\n        super(name);\n        this.EDITABLE = isEditable ?? true;\n        this.displayLocation = opt_displayLocation || FieldTextInputWithFlydown.DISPLAY_RIGHT;\n    }\n\n    init(block) {\n        super.init(block);\n        Blockly.utils.dom.addClass(this.fieldGroup_, this.fieldCSSClassName);\n\n        this.mouseOverWrapper_ = Blockly.browserEvents.bind(\n            this.fieldGroup_, 'mouseover', this, this.onMouseOver_\n        );\n        this.mouseOutWrapper_ = Blockly.browserEvents.bind(\n            this.fieldGroup_, 'mouseout', this, this.onMouseOut_\n        );\n    }\n\n    onMouseOver_(e) {\n        if (!this.sourceBlock_.isInFlyout && FieldTextInputWithFlydown.showPid_ == 0) {\n            FieldTextInputWithFlydown.showPid_ = window.setTimeout(\n                this.showFlydownMaker_(),\n                FieldTextInputWithFlydown.timeout\n            );\n        }\n        e.stopPropagation();\n    }\n\n    onMouseOut_(e) {\n        window.clearTimeout(FieldTextInputWithFlydown.showPid_);\n        FieldTextInputWithFlydown.showPid_ = 0;\n        e.stopPropagation();\n    }\n\n    showFlydownMaker_() {\n        const field = this;\n        return function () {\n            if (FieldTextInputWithFlydown.showPid_ !== 0 &&\n                !field.getSourceBlock().workspace.isDragging() &&\n                !field.htmlInput_) {\n                try {\n                    field.showFlydown_();\n                } catch (e) {\n                    console.error('Failed to show flydown', e);\n                }\n            }\n            FieldTextInputWithFlydown.showPid_ = 0;\n        };\n    }\n\n    showFlydown_() {\n        Blockly.common.getMainWorkspace().hideChaff();\n    \n        if (typeof Blockly.common.getMainWorkspace().getFlydown !== \"function\") {\n            console.error(\"Flydown workspace is not properly initialized!\");\n            return;\n        }\n    \n        const flydown = Blockly.common.getMainWorkspace().getFlydown();\n        if (!flydown) {\n            console.error(\"Flydown is not available!\");\n            return;\n        }\n    \n        Blockly.common.getMainWorkspace().getParentSvg().appendChild(flydown.svgGroup_);\n    \n        const scale = flydown.targetWorkspace.scale;\n        flydown.workspace_.setScale(scale);\n    \n        flydown.setCSSClass(this.flyoutCSSClassName);\n\n        const parentBlock = this.getSourceBlock().getParent();\n        const blockColor = parentBlock ? parentBlock.getColour() : this.getSourceBlock().getColour();\n        document.documentElement.style.setProperty('--flydown-bg-color', blockColor);\n            \n        const blocksXMLText = this.flydownBlocksXML_();\n        const blocksDom = Blockly.utils.xml.textToDom(blocksXMLText);\n        const blocksXMLList = blocksDom.children;\n    \n        const xy = Blockly.common.getMainWorkspace().getSvgXY(this.borderRect_);\n        const borderBBox = this.borderRect_.getBBox();\n    \n        xy.y += borderBBox.height * scale + 5;\n    \n        flydown.field_ = this;\n        flydown.showAt(blocksXMLList, xy.x, xy.y);\n        FieldTextInputWithFlydown.openFieldFlydown_ = this;\n    }\n    \n    flydownBlocksXML_() {\n        const name = this.getText() || 'default';\n        return '<xml>' +\n            '<block type=\"variables_get\">' +\n            '<field name=\"VAR\">' +\n            name +\n            '</field>' +\n            '</block>' +\n            '<block type=\"variables_set\">' +\n            '<field name=\"VAR\">' +\n            name +\n            '</field>' +\n            '</block>' +\n            '</xml>';\n    }\n\n    static hide() {\n        window.clearTimeout(FieldTextInputWithFlydown.showPid_);\n        const flydown = Blockly.common.getMainWorkspace().getFlydown();\n        if (flydown) {\n            flydown.hide();\n        }\n    }\n\n    dispose() {\n        if (FieldTextInputWithFlydown.openFieldFlydown_ == this) {\n            FieldTextInputWithFlydown.hide();\n        }\n        super.dispose();\n    }\n}\n\n","'use strict';\n\nconst cssNode = document.createElement('style');\ndocument.head.appendChild(cssNode);\n\nexport function registerCss(selector) {\n  cssNode.textContent = `\n  ${selector}  .blocklyFieldFlydownFlydown > path {\n    fill: var(--flydown-bg-color) !important;\n    fill-opacity: 0.5;\n    stroke: var(--flydown-bg-color) !important;\n    stroke-width: 4;\n  }\n  .blocklyFieldFlydownFlydown > path {\n    fill: var(--flydown-bg-color) !important;\n    fill-opacity: 0.5;\n    stroke: var(--flydown-bg-color) !important;\n    stroke-width: 4;\n  }\n  `;\n}","'use strict';\n\nimport * as Blockly from 'blockly/core';\nimport {FieldTextInputWithFlydown} from './field_input_flydown_block.js';\n\nexport class Flydown extends Blockly.VerticalFlyout {\n  constructor(workspaceOptions) {\n    super(workspaceOptions);\n    this.dragAngleRange_ = 360;\n  }\n};\n\nFlydown.prototype.previousCSSClassName_ = '';\n\nFlydown.prototype.VERTICAL_SEPARATION_FACTOR = 1;\n\nFlydown.prototype.createDom = function(cssClassName) {\n\n  this.previousCSSClassName_ = cssClassName; \n  this.svgGroup_ =\n      Blockly.utils.dom.createSvgElement('g', {'class': cssClassName}, null);\n  this.svgBackground_ =\n      Blockly.utils.dom.createSvgElement('path', {}, this.svgGroup_);\n  this.svgGroup_.appendChild(this.workspace_.createDom());\n  return this.svgGroup_;\n};\n\nFlydown.prototype.setCSSClass = function(newCSSClassName) {\n  if (newCSSClassName !== this.previousCSSClassName_) {\n    Blockly.utils.dom.removeClass(this.svgGroup_, this.previousCSSClassName_);\n    Blockly.utils.dom.addClass(this.svgGroup_, newCSSClassName);\n    this.previousCSSClassName_ = newCSSClassName;\n  }\n};\n\nFlydown.prototype.init = function(workspace) {\n  Blockly.Flyout.prototype.init.call(this, workspace, false);\n  this.workspace_.setTheme(workspace.getTheme());\n\n  const componentManager = workspace.getComponentManager();\n  if (!componentManager.hasCapability(this.id, Blockly.ComponentManager.Capability.AUTOHIDEABLE)) {\n      componentManager.addCapability(this.id, Blockly.ComponentManager.Capability.AUTOHIDEABLE);\n  }\n};\n\n\nFlydown.prototype.position = function() {\n  return;\n};\n\nFlydown.prototype.showAt = function(xmlList, x, y) {\n  Blockly.Events.disable();\n  try {\n\n    this.show(xmlList);\n  } finally {\n    Blockly.Events.enable();\n  }\n\n  const margin = this.CORNER_RADIUS * this.workspace_.scale;\n  const edgeWidth = this.width_ - 2 * margin;\n  const edgeHeight = this.height_ - 2 * margin;\n  const path = ['M 0,' + margin];\n  path.push('a', margin, margin, 0, 0, 1, margin, -margin); \n  path.push('h', edgeWidth); \n  path.push('a', margin, margin, 0, 0, 1, margin, margin); \n  path.push('v', edgeHeight); \n  path.push('a', margin, margin, 0, 0, 1, -margin, margin); \n  path.push('h', -edgeWidth); \n  path.push('a', margin, margin, 0, 0, 1, -margin, -margin); \n  path.push('z'); \n  this.svgBackground_.setAttribute('d', path.join(' '));\n  this.svgGroup_.setAttribute('transform', 'translate(' + x + ', ' + y + ')');\n};\n\nFlydown.prototype.reflow = function() {\n  this.workspace_.scale = this.targetWorkspace.scale;\n  const scale = this.workspace_.scale;\n  let flydownWidth = 0;\n  let flydownHeight = 0;\n  const margin = this.CORNER_RADIUS * scale;\n  const blocks = this.workspace_.getTopBlocks(false);\n  for (let i = 0, block; block = blocks[i]; i++) {\n    const blockHW = block.getHeightWidth();\n    flydownWidth = Math.max(flydownWidth, blockHW.width * scale);\n    flydownHeight += blockHW.height * scale;\n  }\n  flydownWidth += 2 * margin + this.tabWidth_ * scale; \n\n  const rendererConstants = this.workspace_.getRenderer().getConstants();\n  const startHatHeight = rendererConstants.ADD_START_HATS ?\n      rendererConstants.START_HAT_HEIGHT : 0;\n  flydownHeight += 3 * margin +\n      margin * this.VERTICAL_SEPARATION_FACTOR * (blocks.length) +\n      startHatHeight * scale / 2.0;\n  if (this.width_ != flydownWidth) {\n    for (let j = 0, block; block = blocks[j]; j++) {\n      const blockHW = block.getHeightWidth();\n      const blockXY = block.getRelativeToSurfaceXY();\n      if (this.RTL) {\n\n        const dx = flydownWidth - margin - scale * (this.tabWidth_ - blockXY.x);\n        block.moveBy(dx, 0);\n        blockXY.x += dx;\n      }\n      if (block.flyoutRect_) {\n        block.flyoutRect_.setAttribute('width', blockHW.width);\n        block.flyoutRect_.setAttribute('height', blockHW.height);\n        block.flyoutRect_.setAttribute('x',\n            this.RTL ? blockXY.x - blockHW.width : blockXY.x);\n        block.flyoutRect_.setAttribute('y', blockXY.y);\n      }\n    }\n\n    this.width_ = flydownWidth;\n    this.height_ = flydownHeight;\n  }\n};\n\nFlydown.prototype.onMouseMove_ = function(e) {\n\n  return;\n};\n\nFlydown.prototype.placeNewBlock_ = function(originBlock) {\n  const targetWorkspace = this.targetWorkspace;\n  const svgRootOld = originBlock.getSvgRoot();\n  if (!svgRootOld) {\n    throw Error('originBlock is not rendered.');\n  }\n\n  let scale = this.workspace_.scale;\n\n  const xyOld = this.workspace_.getSvgXY(svgRootOld);\n\n  const scrollX = xyOld.x;\n  xyOld.x += scrollX / targetWorkspace.scale - scrollX;\n\n  const scrollY = xyOld.y;\n  scale = targetWorkspace.scale;\n  xyOld.y += scrollY / scale - scrollY;\n\n  const xml = Blockly.Xml.blockToDom(originBlock);\n  const block = Blockly.Xml.domToBlock(xml, targetWorkspace);\n  const svgRootNew = block.getSvgRoot();\n  if (!svgRootNew) {\n    throw Error('block is not rendered.');\n  }\n\n  const xyNew = targetWorkspace.getSvgXY(svgRootNew);\n\n  xyNew.x +=\n      targetWorkspace.scrollX / targetWorkspace.scale - targetWorkspace.scrollX;\n  xyNew.y +=\n      targetWorkspace.scrollY / targetWorkspace.scale - targetWorkspace.scrollY;\n\n  if (targetWorkspace.toolbox_ && !targetWorkspace.scrollbar) {\n    xyNew.x += targetWorkspace.toolbox_.getWidth() / targetWorkspace.scale;\n    xyNew.y += targetWorkspace.toolbox_.getHeight() / targetWorkspace.scale;\n  }\n\n  block.moveBy(xyOld.x - xyNew.x, xyOld.y - xyNew.y);\n  return block;\n};\n\nFlydown.prototype.shouldHide = true;\n\nFlydown.prototype.hide = function() {\n  if (this.shouldHide) {\n    Blockly.Flyout.prototype.hide.call(this);\n    FieldTextInputWithFlydown.openFieldFlydown_ = null;\n  }\n  this.shouldHide = true;\n};\n\nFlydown.prototype.autoHide = function() {\n  this.hide();\n};\n\n","'use strict';\n\n\nimport * as Blockly from 'blockly/core';\nimport { registerCss } from '../style/css.js';\nimport { Flydown } from '../field/flydown.js';\n\nexport class FieldFlydown {\n\n    static init(workspace) {\n        if (workspace.flydown_) {\n            return; // Prevent duplicate initialization\n        }\n\n        const rendererName = workspace.getRenderer().getClassName();\n        const themeName = workspace.getTheme().getClassName();\n        const selector = `.${rendererName}.${themeName}`;\n        registerCss(selector);\n\n        const flydown = new Flydown(\n            new Blockly.Options({\n                scrollbars: false,\n                rtl: workspace.RTL,\n                renderer: workspace.options.renderer,\n                rendererOverrides: workspace.options.rendererOverrides,\n                parentWorkspace: workspace,\n            })\n        );\n\n        workspace.getFlydown = function () {\n            return this.flydown_;\n        };\n        \n        workspace.flydown_ = flydown;\n        Blockly.utils.dom.insertAfter(flydown.createDom('g'), workspace.svgBubbleCanvas_);\n        flydown.init(workspace);\n        flydown.autoClose = true;\n    }\n\n    static Flydown = Flydown;\n}\n","import { FieldTextInputWithFlydown } from './field/field_input_flydown_block.js';\nimport { FieldFlydown } from './field/feald_flydown_init.js';\n\nFieldTextInputWithFlydown.prototype.fieldCSSClassName = 'blocklyFieldFlydownField';\nFieldTextInputWithFlydown.prototype.flyoutCSSClassName = 'blocklyFieldFlydownFlydown';\n\nif (!Blockly.registry.hasItem(Blockly.registry.Type.FIELD, 'field_text_input_with_flydown')) {\n  Blockly.registry.register(\n    Blockly.registry.Type.FIELD,\n    'field_text_input_with_flydown',\n    FieldTextInputWithFlydown\n  );\n} else {\n  console.warn('Field \"field_text_input_with_flydown\" is already registered.');\n}\n\nexport { FieldTextInputWithFlydown, FieldFlydown };"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE__370__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","FieldTextInputWithFlydown","static","DISPLAY_BELOW","constructor","name","isEditable","opt_displayLocation","super","EDITABLE","displayLocation","DISPLAY_RIGHT","init","block","dom","addClass","fieldGroup_","fieldCSSClassName","mouseOverWrapper_","bind","onMouseOver_","mouseOutWrapper_","onMouseOut_","e","sourceBlock_","isInFlyout","showPid_","window","setTimeout","showFlydownMaker_","timeout","stopPropagation","clearTimeout","field","getSourceBlock","workspace","isDragging","htmlInput_","showFlydown_","console","error","getMainWorkspace","hideChaff","getFlydown","flydown","getParentSvg","appendChild","svgGroup_","scale","targetWorkspace","workspace_","setScale","setCSSClass","flyoutCSSClassName","parentBlock","getParent","blockColor","getColour","document","documentElement","style","setProperty","blocksXMLText","flydownBlocksXML_","blocksXMLList","xml","textToDom","children","xy","getSvgXY","borderRect_","borderBBox","getBBox","y","height","field_","showAt","x","openFieldFlydown_","getText","hide","dispose","cssNode","createElement","head","Flydown","workspaceOptions","dragAngleRange_","previousCSSClassName_","VERTICAL_SEPARATION_FACTOR","createDom","cssClassName","createSvgElement","svgBackground_","newCSSClassName","removeClass","setTheme","getTheme","componentManager","getComponentManager","hasCapability","id","Capability","AUTOHIDEABLE","addCapability","position","xmlList","disable","show","enable","margin","CORNER_RADIUS","edgeWidth","width_","edgeHeight","height_","path","push","setAttribute","join","reflow","flydownWidth","flydownHeight","blocks","getTopBlocks","blockHW","getHeightWidth","Math","max","width","tabWidth_","rendererConstants","getRenderer","getConstants","startHatHeight","ADD_START_HATS","START_HAT_HEIGHT","j","blockXY","getRelativeToSurfaceXY","RTL","dx","moveBy","flyoutRect_","onMouseMove_","placeNewBlock_","originBlock","svgRootOld","getSvgRoot","Error","xyOld","scrollX","scrollY","blockToDom","domToBlock","svgRootNew","xyNew","toolbox_","scrollbar","getWidth","getHeight","shouldHide","autoHide","FieldFlydown","flydown_","selector","getClassName","textContent","scrollbars","rtl","renderer","options","rendererOverrides","parentWorkspace","insertAfter","svgBubbleCanvas_","autoClose","Blockly","registry","hasItem","Type","FIELD","warn","register"],"sourceRoot":""}